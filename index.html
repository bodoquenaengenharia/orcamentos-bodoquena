<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Orçamentos Bodoquena</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#004aad">
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 16px;
            line-height: 1.4;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        h1, h2 {
            text-align: center;
        }
        form {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
        }
        fieldset {
            border: 1px solid #999;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        legend {
            font-weight: bold;
        }
        label {
            display: block;
            margin-top: 8px;
            font-size: 0.9rem;
        }
        input[type="text"],
        input[type="number"],
        input[type="date"] {
            width: 100%;
            padding: 4px;
            box-sizing: border-box;
        }
        .linha {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .linha > div {
            flex: 1 1 160px;
        }
        button {
            margin-top: 10px;
            padding: 10px 18px;
            cursor: pointer;
            border-radius: 4px;
            border: none;
            background: #004aad;
            color: #fff;
            font-weight: bold;
        }
        .proposta {
            border: 1px solid #000;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-line;
            border-radius: 6px;
            background: #fafafa;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        table, th, td {
            border: 1px solid #000;
        }
        th, td {
            padding: 4px;
            text-align: center;
        }
        .right {
            text-align: right;
        }
        .center {
            text-align: center;
        }
        .topbar {
            text-align: center;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: #555;
        }
        .timbrado {
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .timbrado-logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .timbrado-logo img {
            height: 50px;
        }
        .timbrado-texto {
            font-size: 0.85rem;
            text-align: right;
        }
        .rodape-bodoquena {
            margin-top: 20px;
            font-size: 0.85rem;
        }
        .botoes-acao {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        /* Layout para impressão / PDF */
        @media print {
            body {
                margin: 20mm;
                max-width: 100%;
            }
            .topbar,
            form,
            h1,
            h2,
            .botoes-acao {
                display: none !important;
            }
            .proposta {
                border: none;
                padding: 0;
                background: #fff;
            }
        }
    </style>
</head>
<body>
<div class="topbar">
    <strong>Orçamentos Bodoquena</strong> – adicione esta página na tela inicial para usar como aplicativo.
</div>

<!-- Cabeçalho tipo papel timbrado: logo à esquerda, dados à direita -->
<div class="timbrado">
    <div class="timbrado-logo">
        <img src="logo_bodoquena.png" alt="Bodoquena Engenharia">
    </div>
    <div class="timbrado-texto">
        <strong>BODOQUENA ENGENHARIA COMÉRCIO LTDA</strong><br>
        CNPJ 16.043.945/0001-20<br>
        I.E.: 28.396.067-1
    </div>
</div>

<h1>Gerador de Propostas - Bodoquena Engenharia</h1>

<form id="formProposta">
    <fieldset>
        <legend>Dados da Proposta</legend>
        <div class="linha">
            <div>
                <label for="dataProposta">Data (Campo Grande-MS)</label>
                <input type="date" id="dataProposta">
            </div>
            <div>
                <label for="cidadeProposta">Cidade</label>
                <input type="text" id="cidadeProposta" value="Campo Grande-MS">
            </div>
        </div>
        <div class="linha">
            <div>
                <label for="numeroProposta">Número da Proposta (automático, editável)</label>
                <input type="text" id="numeroProposta">
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>Dados do Cliente / Obra</legend>
        <label for="cliente">Cliente</label>
        <input type="text" id="cliente" value="Poligonal Engenharia e Construções LTDA">

        <label for="contato">A/C</label>
        <input type="text" id="contato" value="Renato Abrão">

        <label for="localObra">Obra / Local</label>
        <input type="text" id="localObra" value="SESC – Rua Dom Aquino nº 1631, laje do estacionamento">

        <label for="tituloProposta">Título da Proposta</label>
        <input type="text" id="tituloProposta" value="Impermeabilização com Injeção de Resinas de PU – SESC">
    </fieldset>

    <fieldset>
        <legend>Planilha de Preços</legend>

        <div class="linha">
            <div>
                <label for="qtdVb">Item 01 - Pontos de Injeção (Vb)</label>
                <input type="number" id="qtdVb" value="1" min="0" step="1">
            </div>
            <div>
                <label for="valorVb">Valor unitário Vb (R$)</label>
                <input type="number" id="valorVb" value="4500" min="0" step="0.01">
            </div>
        </div>

        <div class="linha">
            <div>
                <label for="qtdPontoAdic">Item 02 - Pontos Adicinais (unidades)</label>
                <input type="number" id="qtdPontoAdic" value="0" min="0" step="1">
            </div>
            <div>
                <label for="valorPontoAdic">Valor unitário Ponto Adicinal (R$)</label>
                <input type="number" id="valorPontoAdic" value="500" min="0" step="0.01">
            </div>
        </div>

        <div class="linha">
            <div>
                <label for="qtdMetroLinear">Item 03 - Injeção por metro linear (m)</label>
                <input type="number" id="qtdMetroLinear" value="0" min="0" step="0.01">
            </div>
            <div>
                <label for="valorMetroLinear">Valor unitário metro linear (R$)</label>
                <input type="number" id="valorMetroLinear" value="1000" min="0" step="0.01">
            </div>
        </div>

        <div class="linha">
            <div>
                <label for="condPagamento">Condição de Pagamento</label>
                <input type="text" id="condPagamento" value="Após término dos serviços; Prazo a combinar;">
            </div>
            <div>
                <label for="validade">Validade da Proposta (dias)</label>
                <input type="number" id="validade" value="30" min="1" step="1">
            </div>
        </div>
    </fieldset>

    <div class="botoes-acao">
        <button type="button" onclick="gerarProposta()">Gerar Proposta</button>
        <button type="button" onclick="imprimirPDF()">Gerar PDF</button>
    </div>
</form>

<h2>Proposta Gerada</h2>
<div id="saida" class="proposta">
    Preencha os campos acima e clique em "Gerar Proposta".
</div>

<script>
    // PWA
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
            navigator.serviceWorker.register('service-worker.js').catch(function (err) {
                console.log('ServiceWorker falhou: ', err);
            });
        });
    }

    function formatarMoeda(valor) {
        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function numeroPorExtenso(valor) {
        valor = Number(valor.toFixed(2));
        const inteiro = Math.floor(valor);
        const centavos = Math.round((valor - inteiro) * 100);

        if (valor === 0) return 'zero real';

        const unidades = ['', 'um', 'dois', 'três', 'quatro', 'cinco', 'seis', 'sete', 'oito', 'nove'];
        const especiais = ['dez', 'onze', 'doze', 'treze', 'quatorze', 'quinze', 'dezesseis', 'dezessete', 'dezoito', 'dezenove'];
        const dezenas = ['', '', 'vinte', 'trinta', 'quarenta', 'cinquenta', 'sessenta', 'setenta', 'oitenta', 'noventa'];
        const centenas = ['', 'cem', 'cento', 'duzentos', 'trezentos', 'quatrocentos', 'quinhentos', 'seiscentos', 'setecentos', 'oitocentos', 'novecentos'];

        function montaCentena(n) {
            let resultado = '';
            const c = Math.floor(n / 100);
            const d = Math.floor((n % 100) / 10);
            const u = n % 10;

            if (n === 0) return '';
            if (n === 100) return 'cem';

            if (c !== 0) {
                resultado += centenas[c];
            }
            if (d === 1) {
                if (resultado) resultado += ' e ';
                resultado += especiais[u];
            } else {
                if (d > 1) {
                    if (resultado) resultado += ' e ';
                    resultado += dezenas[d];
                }
                if (u > 0) {
                    if (resultado) resultado += ' e ';
                    resultado += unidades[u];
                }
            }
            return resultado;
        }

        let partes = [];
        const milhoes = Math.floor(inteiro / 1000000);
        const restoMilhoes = inteiro % 1000000;
        const milhares = Math.floor(restoMilhoes / 1000);
        const resto = restoMilhoes % 1000;

        if (milhoes > 0) {
            if (milhoes === 1) partes.push('um milhão');
            else partes.push(montaCentena(milhoes) + ' milhões');
        }
        if (milhares > 0) {
            if (milhares === 1) partes.push('mil');
            else partes.push(montaCentena(milhares) + ' mil');
        }
        if (resto > 0) {
            partes.push(montaCentena(resto));
        }

        let extensoReais = partes.join(' e ');
        if (inteiro === 1) extensoReais += ' real';
        else extensoReais += ' reais';

        if (centavos > 0) {
            let extensoCentavos = montaCentena(centavos);
            if (centavos === 1) extensoCentavos += ' centavo';
            else extensoCentavos += ' centavos';
            extensoReais += ' e ' + extensoCentavos;
        }

        return extensoReais.charAt(0).toUpperCase() + extensoReais.slice(1);
    }

    function formatarDataExtenso(cidade, dateStr) {
        const meses = [
            'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
            'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
        ];
        let d;
        if (!dateStr) {
            d = new Date();
        } else {
            d = new Date(dateStr + 'T00:00:00');
            if (isNaN(d.getTime())) d = new Date();
        }
        const dia = String(d.getDate()).padStart(2, '0');
        const mesNome = meses[d.getMonth()];
        const ano = d.getFullYear();
        return `${cidade}, ${dia} de ${mesNome} de ${ano}.`;
    }

    function gerarProposta() {
        const cidade = document.getElementById('cidadeProposta').value || 'Campo Grande-MS';
        const data = formatarDataExtenso(cidade, document.getElementById('dataProposta').value);

        const numeroProposta = document.getElementById('numeroProposta').value || '';
        const cliente = document.getElementById('cliente').value || 'Poligonal Engenharia e Construções LTDA';
        const contato = document.getElementById('contato').value || 'Renato Abrão';
        const localObra = document.getElementById('localObra').value || 'SESC – Rua Dom Aquino nº 1631, laje do estacionamento';
        const tituloProposta = document.getElementById('tituloProposta').value || 'Impermeabilização com Injeção de Resinas de PU – SESC';

        const qtdVb = Number(document.getElementById('qtdVb').value || 0);
        const valorVb = Number(document.getElementById('valorVb').value || 0);

        const qtdPontoAdic = Number(document.getElementById('qtdPontoAdic').value || 0);
        const valorPontoAdic = Number(document.getElementById('valorPontoAdic').value || 0);

        const qtdMetroLinear = Number(document.getElementById('qtdMetroLinear').value || 0);
        const valorMetroLinear = Number(document.getElementById('valorMetroLinear').value || 0);

        const condPagamento = document.getElementById('condPagamento').value || 'Após término dos serviços; Prazo a combinar;';
        const validade = Number(document.getElementById('validade').value || 30);

        const totalVb = qtdVb * valorVb;
        const totalPontoAdic = qtdPontoAdic * valorPontoAdic;
        const totalMetroLinear = qtdMetroLinear * valorMetroLinear;

        const totalGeral = totalVb + totalPontoAdic + totalMetroLinear;
        const totalGeralFormatado = formatarMoeda(totalGeral);
        const totalExtenso = numeroPorExtenso(totalGeral);

        let linhasTabela = '';

        const qtdTextoVb = qtdVb > 0 ? `${qtdVb} Vb*` : '1 Vb*';
        const totalItemVb = qtdVb > 0 ? totalVb : valorVb;
        linhasTabela += `
        <tr>
            <td>01</td>
            <td class="center">Pontos de injeção</td>
            <td class="center">${qtdTextoVb}</td>
            <td class="right">${formatarMoeda(valorVb)}</td>
            <td class="right">${formatarMoeda(totalItemVb)}</td>
        </tr>`;

        if (qtdPontoAdic > 0) {
            linhasTabela += `
            <tr>
                <td>02</td>
                <td class="center">Ponto Adicinal</td>
                <td class="center">${qtdPontoAdic} Und</td>
                <td class="right">${formatarMoeda(valorPontoAdic)}</td>
                <td class="right">${formatarMoeda(totalPontoAdic)}</td>
            </tr>`;
        } else {
            linhasTabela += `
            <tr>
                <td>02</td>
                <td class="center">Ponto Adicinal</td>
                <td class="center">Und</td>
                <td class="right">${formatarMoeda(valorPontoAdic)}</td>
                <td class="right">-</td>
            </tr>`;
        }

        if (qtdMetroLinear > 0) {
            linhasTabela += `
            <tr>
                <td>03</td>
                <td class="center">Injeção por metro linear</td>
                <td class="center">${qtdMetroLinear.toFixed(2)} m</td>
                <td class="right">${formatarMoeda(valorMetroLinear)}</td>
                <td class="right">${formatarMoeda(totalMetroLinear)}</td>
            </tr>`;
        } else {
            linhasTabela += `
            <tr>
                <td>03</td>
                <td class="center">Injeção por metro linear</td>
                <td class="center">-</td>
                <td class="right">${formatarMoeda(valorMetroLinear)}</td>
                <td class="right">-</td>
            </tr>`;
        }

        const linhaNumero = numeroProposta ? `Proposta nº ${numeroProposta}\n` : '';

        const html = `
${data}


À ${cliente}

A/C: ${contato}


${linhaNumero}Proposta: ${tituloProposta}


A Bodoquena Engenharia apresenta proposta técnica-comercial para os serviços de impermeabilização com injeção de resina de poliuretano (PU) no ${localObra}, conforme detalhamento abaixo:

Descrição Técnica:

Tipo de resina: Gel de Poliuretano dúctil-elástico para selamento de trincas por injeção;

Aplicação: Injeção sob pressão com equipamento Airless.

Técnica: Uso de válvulas de injeção, em trincas e juntas.

Finalidade: Vedação de infiltrações em concreto.

Pontos : ${qtdVb > 0 ? qtdVb : 1} unidade 


Itens inclusos no Serviço:

Mão de Obra especializada;

Equipamentos e materiais específicos;

Locomoção, alimentação e despesas da equipe técnica;

Limpeza da área de trabalho;

Coleta, retirada e destinação dos resíduos gerados;


Itens NÃO Inclusos no Serviço:

Instalações elétricas e hidráulicas; 

Refeitório e banheiros para equipe técnica; 


Serviços propostos – Iniciais:

<table>
    <thead>
        <tr>
            <th>Item</th>
            <th>Descrição</th>
            <th>Quantidade</th>
            <th>Valor Unitário</th>
            <th>Valor Total</th>
        </tr>
    </thead>
    <tbody>
        ${linhasTabela}
        <tr>
            <td colspan="5">
                <div style="display:flex;justify-content:space-between;">
                    <span>*Vb: Para até 3 pontos no mesmo local</span>
                    <span>Total: <strong>${totalGeralFormatado}</strong></span>
                </div>
            </td>
        </tr>
    </tbody>
</table>

Critério de Medição e Faturamento:

O quantitativo apresentado nesta proposta foi estimado de forma preliminar, tomando como base nas condições aparentes no momento da vistoria.

Todavia, caso sejam identificados pontos de injeção cuja natureza apresente características de fissuras com desenvolvimento em metragem linear, o serviço correspondente será medido e faturado por metro linear, conforme o item específico da planilha de preços.

Condição de Pagamento:

${condPagamento}

Validade da Proposta:

${validade} Dias;

Garantia do serviço:

12 meses para reaparecimento de infiltrações nos locais tratados;

Valor total da Proposta

${totalGeralFormatado} (${totalExtenso}).


Atenciosamente,


Renato Ferreira Lopes Brum

(67) 99982 7011

Bodoquena Engenharia Comércio LTDA


<div class="rodape-bodoquena">
BODOQUENA ENGENHARIA<br>
Rua Treze de Junho, nº 916, Bairro Vila Cidade – Campo Grande/MS
</div>
        `;

        document.getElementById('saida').innerHTML = html;
    }

    // Número de proposta automático baseado na data/hora
    (function () {
        const hoje = new Date();
        const ano = hoje.getFullYear();
        const mes = String(hoje.getMonth() + 1).padStart(2, '0');
        const dia = String(hoje.getDate()).padStart(2, '0');
        const hora = String(hoje.getHours()).padStart(2, '0');
        const min = String(hoje.getMinutes()).padStart(2, '0');

        document.getElementById('dataProposta').value = `${ano}-${mes}-${dia}`;
        document.getElementById('numeroProposta').value = `${ano}${mes}${dia}-${hora}${min}`;
    })();

    function imprimirPDF() {
        // Usa a função de impressão do navegador (no iPhone permite salvar em PDF)
        window.print();
    }
</script>
</body>
</html>
